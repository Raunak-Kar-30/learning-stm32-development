// Driver program for implementing the USART RX and TX functionality using interrupts

// Includes
#include "usart_interrupt.h"

// Function declarations (private)

// Functions
// Initialize USARt2
void usart2_init(void)
{

}

// Recieve some data via USART2 using interrupts
void usart2_rx_using_interrupt(void)
{
	// We do not need SYSCFG because we are not setting up external interrupt lines

	// Enable clock access to USART2, GPIOA, SYSCFG (no need to check if clock access is already enabled - waste of cpu clocks)
	RCC->AHB1ENR |= GPIOA_CLK_EN;
	RCC->APB1ENR |= USART2_CLK_EN;
	//RCC->APB2ENR |= SYSCFG_CLK_EN;

	// Set up the pins for USART RX (PA3), USR_LED (PA5)
	GPIOA->MODER |= (1UL << 10 | 1UL << 7);
	GPIOA->MODER &= ~(1UL << 11 | 1UL << 6);

	// Enable interrupt for USART2 using the RXNEIE (RXNE interrupt enable bit) in Control Register 2
	// Now whenever there is some data in the data register (and shift register becomes empty), an interrupt is generated
	USART2->CR1 |= USART2_RXNEIE;
}
