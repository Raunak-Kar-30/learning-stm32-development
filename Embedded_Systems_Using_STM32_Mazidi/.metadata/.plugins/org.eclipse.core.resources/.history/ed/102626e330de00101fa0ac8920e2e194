// ADC driver programs for various ADC modules and functionalities

// Includes
#include "adc_conversion.h"

// Function declarations
// Initialize the ADC module and keep reading values from the in-built temperature sensor, and displaying them via USART
void adc_temp_conversion(void)
{
	// Initialize Timer 2 for ADC converion signalling
	timer2_setup_adc();

	// Initialize USART2 module for writing the ADC converted value to USART2 TX.
	usart2_init();

	// Enable clock access to ADC1
	RCC->APB2ENR |= ADC1_CLK_EN;

	// Set the temp sensor channel - channel 18 as the first in the sequence of ADC conversion (since we have no other conversions)
	// We write channel number - 18 to SQ1 (Sequence 1) bits of ADC1 Regular Sequence Register 3

	// Set the resolution for the ADC1 - we set it to 12 bit resolution.

	// Set the sampling time appropriately (according to the resolution).
	// Since we choose 12 bit resolution, we set sampling clock cycles to 28 cycles, in Sample Time Register 1

	// Turn on the on-board temperature sensor connected to channel 18, we also need to disable VBAT since it is also connected to the same channel
	// - channel 18 as the temperature sensor, and when both Temp-sensor and VBAT are enabled, only the VBAT value will be read and converted.

	// Set the ADC conversion to occur every EXTEN rising edge. Select the EXTSEL to Timer 2 channel 2 Capture/Compare Event.

	// Enable the ADC1

	// Keep reading data from the temp-sensor, and print the data to USART2
	while(1)
	{
		// Start conversion on channel 18

		// Wait until End of Conversion bit is set in Status Register

		// Read the data from the ADC1 Data Register

		// Convert the data read (which is expressed in terms of voltage) to readable temperature data.
		// For that we use the formula referred to in page 377 of (ref manual) RM0390.
		// Formula according to RM0390 is => [Temp(deg Cel) = {(V_sensor - V_25) / Avg_slope} + 25].
		// To get the values of V_25 and Avg_slope - refer datasheet

		// Print the raw data value and temp value to the terminal via USART.
	}
}
